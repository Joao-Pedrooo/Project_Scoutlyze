{% extends "base.html" %}
{% block title %}Editar Partida{% endblock %}
{% block content %}
<div class="container mt-5">
  <h1 class="text-center">Editar Partida</h1>
  <form action="/api/partidas/editar/{{ partida.partida_id }}" method="post" class="mb-4">
    <div class="row">
      <div class="col-md-4 mb-3">
        <label for="time_casa_id" class="form-label">Time Mandante</label>
        <select id="time_casa_id" name="time_casa_id" class="form-select" required>
          <option value="" disabled hidden>Selecione um time</option>
          {% for time in times %}
          <option value="{{ time.time_id }}" {% if time.time_id == partida.time_casa_id %}selected{% endif %}>
            {{ time.nome }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label for="time_visitante_id" class="form-label">Time Visitante</label>
        <select id="time_visitante_id" name="time_visitante_id" class="form-select" required>
          <option value="" disabled hidden>Selecione um time</option>
          {% for time in times %}
          <option value="{{ time.time_id }}" {% if time.time_id == partida.time_visitante_id %}selected{% endif %}>
            {{ time.nome }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label for="campeonato" class="form-label">Campeonato</label>
        <select id="campeonato" name="campeonato" class="form-select" required>
          <option value="" disabled hidden>Selecione o campeonato</option>
          <option value="brasileiro" {% if partida.campeonato == "brasileiro" %}selected{% endif %}>Brasileiro</option>
          <option value="catarinense_ouro" {% if partida.campeonato == "catarinense_ouro" %}selected{% endif %}>Catarinense Ouro</option>
          <option value="catarinense_prata" {% if partida.campeonato == "catarinense_prata" %}selected{% endif %}>Catarinense Prata</option>
          <option value="gaucho" {% if partida.campeonato == "gaucho" %}selected{% endif %}>Gaucho</option>
          <option value="copa_sc" {% if partida.campeonato == "copa_sc" %}selected{% endif %}>Copa SC</option>
          <option value="copa_rs" {% if partida.campeonato == "copa_rs" %}selected{% endif %}>Copa RS</option>
          <option value="local_rs" {% if partida.campeonato == "local_rs" %}selected{% endif %}>Local RS</option>
        </select>
      </div>
    </div>
    <div class="mb-3">
      <label for="fase_competicao" class="form-label">Fase da Competição</label>
      <select id="fase_competicao" name="fase_competicao" class="form-select" required>
        <option value="" disabled>Selecione a fase</option>
        <!-- Se existir rodada, consideramos classificatório -->
        <option value="classificatorio" {% if partida.rodada %}selected{% endif %}>Classificatório</option>
        <!-- Caso contrário, eliminatório -->
        <option value="eliminatorio" {% if not partida.rodada %}selected{% endif %}>Eliminatório</option>
      </select>
    </div>
    <div class="row">
      <div class="col-md-6 mb-3" id="div_dinamica">
        {% if partida.rodada %}
          <!-- Para partidas classificatórias, exibe os dois campos -->
          <label class="form-label">Rodada</label>
          <select name="rodada" class="form-select" required>
            <option value="" disabled hidden>Selecione a rodada</option>
            {% for i in range(1, 21) %}
              <option value="{{ i }}" {% if partida.rodada == i %}selected{% endif %}>{{ i }}</option>
            {% endfor %}
          </select>
          <label class="form-label mt-2">Local da Partida</label>
          <select name="local_partida" class="form-select" required>
            <option value="" disabled hidden>Selecione se é Casa ou Fora</option>
            <option value="Casa" {% if partida.local_partida == "Casa" %}selected{% endif %}>Casa</option>
            <option value="Fora" {% if partida.local_partida == "Fora" %}selected{% endif %}>Fora</option>
          </select>
        {% else %}
          <!-- Para partidas eliminatórias, exibe somente o campo de local -->
          <label class="form-label">Local da Partida</label>
          <select name="local_partida" class="form-select" required>
            <option value="" disabled hidden>Selecione se é Casa ou Fora</option>
            <option value="Casa" {% if partida.local_partida == "Casa" %}selected{% endif %}>Casa</option>
            <option value="Fora" {% if partida.local_partida == "Fora" %}selected{% endif %}>Fora</option>
          </select>
        {% endif %}
      </div>
      <div class="col-md-6 mb-3">
        <label for="data_partida" class="form-label">Data da Partida</label>
        <input type="date" id="data_partida" name="data_partida" class="form-control" value="{{ partida.data_partida.strftime('%Y-%m-%d') }}" required>
      </div>
    </div>
    <!-- Campo oculto para "periodo" (default 1) -->
    <input type="hidden" name="periodo" value="1">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="placar_casa" class="form-label">Placar Mandante</label>
        <input type="number" id="placar_casa" name="placar_casa" class="form-control" value="{{ partida.placar_casa }}" required>
      </div>
      <div class="col-md-6 mb-3">
        <label for="placar_visitante" class="form-label">Placar Visitante</label>
        <input type="number" id="placar_visitante" name="placar_visitante" class="form-control" value="{{ partida.placar_visitante }}" required>
      </div>
    </div>
    <button type="submit" class="btn btn-primary w-100">
      <i class="fas fa-save"></i> Salvar Alterações
    </button>
  </form>
</div>

<script>
  // Função para atualizar o campo dinâmico conforme a fase da competição na edição
  function atualizaTipoJogo(tipo) {
    var divDinamica = document.getElementById("div_dinamica");
    divDinamica.innerHTML = "";
    if (tipo === "classificatorio") {
      // Cria o campo de Rodada
      var labelRodada = document.createElement("label");
      labelRodada.className = "form-label";
      labelRodada.innerText = "Rodada";
      var selectRodada = document.createElement("select");
      selectRodada.className = "form-select";
      selectRodada.name = "rodada";
      selectRodada.required = true;
      var placeholderRodada = document.createElement("option");
      placeholderRodada.value = "";
      placeholderRodada.disabled = true;
      placeholderRodada.hidden = true;
      placeholderRodada.selected = true;
      placeholderRodada.innerText = "Selecione a rodada";
      selectRodada.appendChild(placeholderRodada);
      for (var i = 1; i <= 20; i++) {
        var option = document.createElement("option");
        option.value = i;
        option.innerText = i;
        selectRodada.appendChild(option);
      }
      divDinamica.appendChild(labelRodada);
      divDinamica.appendChild(selectRodada);

      // Cria o campo para Local da Partida
      var labelLocal = document.createElement("label");
      labelLocal.className = "form-label mt-2";
      labelLocal.innerText = "Local da Partida";
      var selectLocal = document.createElement("select");
      selectLocal.className = "form-select";
      selectLocal.name = "local_partida";
      selectLocal.required = true;
      var placeholderLocal = document.createElement("option");
      placeholderLocal.value = "";
      placeholderLocal.disabled = true;
      placeholderLocal.hidden = true;
      placeholderLocal.selected = true;
      placeholderLocal.innerText = "Selecione se é Casa ou Fora";
      selectLocal.appendChild(placeholderLocal);
      var optionCasa = document.createElement("option");
      optionCasa.value = "Casa";
      optionCasa.innerText = "Casa";
      var optionFora = document.createElement("option");
      optionFora.value = "Fora";
      optionFora.innerText = "Fora";
      selectLocal.appendChild(optionCasa);
      selectLocal.appendChild(optionFora);
      divDinamica.appendChild(labelLocal);
      divDinamica.appendChild(selectLocal);
    } else if (tipo === "eliminatorio") {
      // Para eliminatório, exibe somente o campo de Local da Partida
      var label = document.createElement("label");
      label.className = "form-label";
      label.innerText = "Local da Partida";
      var select = document.createElement("select");
      select.className = "form-select";
      select.name = "local_partida";
      select.required = true;
      var placeholder = document.createElement("option");
      placeholder.value = "";
      placeholder.disabled = true;
      placeholder.hidden = true;
      placeholder.selected = true;
      placeholder.innerText = "Selecione se é Casa ou Fora";
      select.appendChild(placeholder);
      var optionCasa = document.createElement("option");
      optionCasa.value = "Casa";
      optionCasa.innerText = "Casa";
      var optionFora = document.createElement("option");
      optionFora.value = "Fora";
      optionFora.innerText = "Fora";
      select.appendChild(optionCasa);
      select.appendChild(optionFora);
      divDinamica.appendChild(label);
      divDinamica.appendChild(select);
    }
  }
  document.getElementById("fase_competicao").addEventListener("change", function() {
    atualizaTipoJogo(this.value);
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
{% endblock %}
