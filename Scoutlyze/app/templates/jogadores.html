{% extends "base.html" %}

{% block title %}Cadastro de Jogadores{% endblock %}

{% block content %}
<!-- Estilos customizados para exibir 5 cards por linha em telas grandes -->
<style>
  @media (min-width: 992px) {
    .col-5 {
      flex: 0 0 20%;
      max-width: 20%;
    }
  }
  @media (min-width: 768px) and (max-width: 991.98px) {
    .col-5 {
      flex: 0 0 33.33%;
      max-width: 33.33%;
    }
  }
  @media (max-width: 767.98px) {
    .col-5 {
      flex: 0 0 50%;
      max-width: 50%;
    }
  }
  @media (max-width: 575.98px) {
    .col-5 {
      flex: 0 0 100%;
      max-width: 100%;
    }
  }
</style>

<div class="container mt-5">
  <!-- Formulário de Cadastro -->
  <h1 id="formulario" class="text-center">Cadastro de Jogadores</h1>
  <form action="/api/jogadores/" method="post" class="mb-4">
    <div class="mb-3">
      <label for="nome" class="form-label">Nome do Jogador</label>
      <input type="text" id="nome" name="nome" class="form-control" required />
    </div>
    <div class="mb-3">
      <label for="numero" class="form-label">Número da Camisa</label>
      <input type="number" id="numero" name="numero" class="form-control" required min="0" max="99" />
    </div>
    <div class="mb-3">
      <label for="posicao" class="form-label">Posição</label>
      <select id="posicao" name="posicao" class="form-select" required>
        <option value="" disabled hidden selected>Selecione uma posição</option>
        <option value="goleiro">Goleiro</option>
        <option value="fixo">Fixo</option>
        <option value="ala">Ala</option>
        <option value="pivo">Pivô</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="pe_dominante" class="form-label">Lateralidade</label>
      <select id="pe_dominante" name="pe_dominante" class="form-select" required>
        <option value="" disabled hidden selected>Selecione a lateralidade</option>
        <option value="direito">Direito</option>
        <option value="esquerdo">Esquerdo</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="time_id" class="form-label">Time</label>

      <select id="time_id" name="time_id" class="form-select" required>
        <option value="" disabled hidden selected>Selecione um time</option>
        {% for time in times %}
        <option value="{{ time.time_id }}">{{ time.nome }} (ID: {{ time.time_id }})</option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn btn-primary w-100">
      <i class="fas fa-plus-circle"></i> Cadastrar
    </button>
  </form>

  <!-- Lista de Jogadores Agrupados por Time -->
  <h2 id="lista-jogadores" class="text-center mt-5">Jogadores Cadastrados</h2>
  {% for time_id, jogadores_do_time in groups %}
    {% set time_info = times|selectattr("time_id", "equalto", time_id)|first %}
    <div class="mt-4">
      <h3 class="text-secondary">
        <i class="fas fa-users"></i> Time: {{ time_info.nome if time_info else "Sem Time" }}
      </h3>
      <div class="d-flex flex-wrap">
        {% for jogador in jogadores_do_time %}
        <div class="col-5 p-2">
          <div class="card h-100 shadow-sm">
            <div class="card-body">
              <h5 class="card-title text-primary">{{ jogador.nome }}</h5>
              <p class="card-text">
                <strong>Nº da Camisa:</strong> {{ jogador.numero_camisa }}<br>
                <strong>Posição:</strong> {{ jogador.posicao|capitalize }}
              </p>
            </div>
            <div class="card-footer text-center">
              <a href="/api/jogadores/editar/{{ jogador.jogador_id }}" class="btn btn-sm btn-warning me-1">Editar
                <i class="fas fa-edit"></i>
              </a>
              <button class="btn btn-sm btn-danger" onclick="deletarJogador('{{ jogador.jogador_id }}')">Deletar
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  {% endfor %}
</div>

<script>
  // Função para filtrar os times no dropdown de seleção
  function filtrarTimes() {
    var input = document.getElementById("time_search");
    var filter = input.value.toLowerCase();
    var select = document.getElementById("time_id");
    var options = select.getElementsByTagName("option");
    for (var i = 0; i < options.length; i++) {
      var txtValue = options[i].textContent || options[i].innerText;
      if (txtValue.toLowerCase().indexOf(filter) > -1) {
        options[i].style.display = "";
      } else {
        options[i].style.display = "none";
      }
    }
  }

  async function deletarJogador(jogadorId) {
    if (confirm("Tem certeza que deseja excluir este jogador?")) {
      try {
        const response = await fetch(`/api/jogadores/${jogadorId}`, { method: "DELETE" });
        if (response.ok) {
          alert("Jogador deletado com sucesso!");
          location.reload();
        } else {
          alert("Erro ao excluir o jogador.");
        }
      } catch (error) {
        alert("Erro ao excluir o jogador: " + error.message);
      }
    }
  }
</script>

<script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
{% endblock %}
